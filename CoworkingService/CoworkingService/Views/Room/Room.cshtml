@model Room

@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer

<h1>
    @Localizer["Id of this room is"] @Model.Id
</h1>


<div class="calendarContainer">
    <div id="calendar"></div>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.1.0/main.min.css">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.1.0/main.min.js"></script>

<div class="row">
    <div class="col">

    </div>
    <table id="todoTable">
        @for (int i = 0; i < Enumerable.Count(Model.RoomOccupations); i++)
        {
            <tr>
                <td>@Html.Encode(Model.RoomOccupations.ElementAt(i).Id)</td>
                <td>@Html.Encode(Model.RoomOccupations.ElementAt(i).Title)</td>
                <td>@Html.Encode(Model.RoomOccupations.ElementAt(i).StartDate)</td>
                @*<td>@Html.Encode(Model.RoomOccupations.ElementAt(i).EndDate)</td>*@
            </tr>
        }
    </table>
</div>
<div class="col">

     @{await Html.RenderPartialAsync("RoomOccupationPartial", new RoomOccupied(Model.Id));}
  
</div>
<script>
    let eventsArr = loadData();
    let calendar = initCalendar();
    function loadData() {
        let eventsArr = [];
        let todoTable = document.getElementById("todoTable");
        let trElem = todoTable.getElementsByTagName("tr");
        console.log(trElem);
        for (let tr of trElem) {
            let tdElems = tr.getElementsByTagName("td");
            console.log(tdElems);
            let eventObj = {
                id: tdElems[0].innerText,
                title: tdElems[1].innerText,
                start: tdElems[2].innerText,
                /*end: tdElems[3].innerText,*/
            }
            eventsArr.push(eventObj);
        }
        return eventsArr;
    }
    function initCalendar() {
        var calendarEl = document.getElementById('calendar');
        let calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },
            events: eventsArr,
        });
        calendar.render();
        return calendar;
    }
</script>